
> letstry@0.0.1 test:e2e
> jest --config ./test/jest-e2e.json test/product.e2e-spec.ts

  console.error
    findAllPaginated Filter: {
      "$and": [
        {
          "isArchived": false
        },
        {
          "availabilityStatus": {
            "$ne": "out_of_stock"
          }
        }
      ]
    }

      486 |   ): Promise<PaginationResult<Product>> {
      487 |     const filter = ProductQueryBuilder.forAll(includeOutOfStock, includeArchived);
    > 488 |     console.error('findAllPaginated Filter:', JSON.stringify(filter, null, 2));
          |             ^
      489 |     const strategy = this.cacheStrategyFactory.createForGlobalList(
      490 |       page,
      491 |       limit,

      at ProductQueryService.findAllPaginated (../src/product/product.service.ts:488:13)
      at ProductService.findAllPaginated (../src/product/product.service.ts:729:30)
      at ProductResolver.getProducts (../src/product/product.resolver.ts:40:46)
      at ../node_modules/.pnpm/@nestjs+core@11.1.9_@nestjs+common@11.1.9_class-transformer@0.5.1_class-validator@0.14._35aa21069415c61cc2ff03470cea104c/node_modules/@nestjs/core/helpers/external-context-creator.js:67:33
      at target (../node_modules/.pnpm/@nestjs+core@11.1.9_@nestjs+common@11.1.9_class-transformer@0.5.1_class-validator@0.14._35aa21069415c61cc2ff03470cea104c/node_modules/@nestjs/core/helpers/external-context-creator.js:74:28)
      at ../node_modules/.pnpm/@nestjs+core@11.1.9_@nestjs+common@11.1.9_class-transformer@0.5.1_class-validator@0.14._35aa21069415c61cc2ff03470cea104c/node_modules/@nestjs/core/helpers/external-proxy.js:9:24

  console.error
    findAllPaginated Filter: {
      "$and": [
        {
          "isArchived": false
        },
        {
          "availabilityStatus": {
            "$ne": "out_of_stock"
          }
        }
      ]
    }

      486 |   ): Promise<PaginationResult<Product>> {
      487 |     const filter = ProductQueryBuilder.forAll(includeOutOfStock, includeArchived);
    > 488 |     console.error('findAllPaginated Filter:', JSON.stringify(filter, null, 2));
          |             ^
      489 |     const strategy = this.cacheStrategyFactory.createForGlobalList(
      490 |       page,
      491 |       limit,

      at ProductQueryService.findAllPaginated (../src/product/product.service.ts:488:13)
      at ProductService.findAllPaginated (../src/product/product.service.ts:729:30)
      at ProductResolver.getProducts (../src/product/product.resolver.ts:40:46)
      at ../node_modules/.pnpm/@nestjs+core@11.1.9_@nestjs+common@11.1.9_class-transformer@0.5.1_class-validator@0.14._35aa21069415c61cc2ff03470cea104c/node_modules/@nestjs/core/helpers/external-context-creator.js:67:33
      at target (../node_modules/.pnpm/@nestjs+core@11.1.9_@nestjs+common@11.1.9_class-transformer@0.5.1_class-validator@0.14._35aa21069415c61cc2ff03470cea104c/node_modules/@nestjs/core/helpers/external-context-creator.js:74:28)
      at ../node_modules/.pnpm/@nestjs+core@11.1.9_@nestjs+common@11.1.9_class-transformer@0.5.1_class-validator@0.14._35aa21069415c61cc2ff03470cea104c/node_modules/@nestjs/core/helpers/external-proxy.js:9:24

2025-12-07T12:25:06.293Z [32minfo[39m: Product created: 693572224449fe1adce6dca1 
2025-12-07T12:25:06.305Z [32minfo[39m: Product updated: 693572224449fe1adce6dca8 
FAIL test/product.e2e-spec.ts
  Product (e2e)
    Product Queries (Public)
      âœ“ should get empty products list (37 ms)
      âœ• should get products with category field resolver (9 ms)
      âœ“ should get product by id (9 ms)
      âœ“ should get product by slug (9 ms)
      âœ“ should get products by category (10 ms)
      âœ“ should search products (8 ms)
      âœ“ should return null for non-existent product (8 ms)
    Product Mutations (Admin Only)
      âœ“ should allow ADMIN to create a product (16 ms)
      âœ“ should allow ADMIN to update a product (12 ms)
      âœ“ should fail to create product with duplicate slug (14 ms)
    Product Mutations (Forbidden for User)
      âœ“ should FORBID USER from creating a product (7 ms)
      âœ“ should FORBID USER from updating a product (6 ms)

  â— Product (e2e) â€º Product Queries (Public) â€º should get products with category field resolver

    expect(received).toHaveLength(expected)

    Expected length: 1
    Received length: 0
    Received array:  []

      185 |         })
      186 |         .expect(200)
    > 187 |         .expect((res) => {
          |          ^
      188 |           expect(res.body.data.products.items).toHaveLength(1);
      189 |           expect(res.body.data.products.items[0].category).toBeDefined();
      190 |           expect(res.body.data.products.items[0].category.name).toBe('Snacks');

      at Object.<anonymous> (product.e2e-spec.ts:187:10)
      ----
      at product.e2e-spec.ts:188:48
      at ../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:195:23)
      at localAssert (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:152:11)

Test Suites: 1 failed, 1 total
Tests:       1 failed, 11 passed, 12 total
Snapshots:   0 total
Time:        1.864 s, estimated 2 s
Ran all test suites matching test/product.e2e-spec.ts.
